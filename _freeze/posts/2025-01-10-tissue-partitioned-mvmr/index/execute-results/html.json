{
  "hash": "2577f89b545f0f3080bc3e7ad7abad6b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Tissue-partitioned BMI instrument procedure\"\nauthor: \"Nick Sunderland\"\ndate: \"2025-01-10\"\nexecute:\n  fig-path: \"posts/2025-01-10-tissue-partitioned-mvmr/\" \n---\n\n\n\n## Motivation\nWhat does the weighting by PPH4 do to tissue partitioned BMI instruments? Let's simulate some tissue partitioned BMI MR results.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(data.table)\nlibrary(ggplot2)\nlibrary(genepi.utils)\n```\n:::\n\n\n\n\n## BMI data\nFirst load the BMI GWAS.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbmi <- readRDS(file.path(TPMR_DIR, \"output\", \"tmp_objects\", \"obj_bmi.RDS\"))\nbmi\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ngenepi.utils::GWAS object\n- trait: bmi \n- id: combined_bmi_giant_ukb_annot.txt \n# A tibble: 6 × 26\n  rsid  chr       bp ea    oa      eaf     beta      se     p      n ncase trait\n  <chr> <chr>  <int> <chr> <chr> <dbl>    <dbl>   <dbl> <dbl>  <int> <int> <chr>\n1 rs10… 1     2.27e8 T     G     0.833  0.00380 0.00263  0.15 463005    NA bmi  \n2 rs10… 1     1.63e8 T     C     0.855  0.0027  0.0024   0.26 690227    NA bmi  \n3 rs10… 1     2.22e8 C     T     0.653  0.00124 0.00206  0.55 463005    NA bmi  \n4 rs10… 1     1.57e8 A     G     0.394  0.0007  0.0018   0.7  688612    NA bmi  \n5 rs10… 1     9.52e7 T     C     0.352 -0.0011  0.0018   0.54 686026    NA bmi  \n6 rs10… 1     6.69e7 C     G     0.217  0.0034  0.0021   0.1  685310    NA bmi  \n# ℹ 14 more variables: id <chr>, strand <chr>, imputed <lgl>, info <dbl>,\n#   q <dbl>, q_p <dbl>, i2 <dbl>, proxy_rsid <chr>, proxy_chr <chr>,\n#   proxy_bp <int>, proxy_ea <chr>, proxy_oa <chr>, proxy_eaf <dbl>,\n#   proxy_r2 <dbl>\n```\n\n\n:::\n:::\n\n\n\n<!-- ## Heart failure data -->\n<!-- Load the heart failure GWAS. -->\n\n<!-- ```{r, message=FALSE, eval=F} -->\n<!-- hf <- readRDS(file.path(dir, \"tmp_objects\", \"obj_hf_allcause.RDS\")) -->\n<!-- hf -->\n<!-- ``` -->\n\n<!-- ## Harmonise the datasets -->\n<!-- ```{r, message=FALSE, eval=F} -->\n<!-- h   <- MR(bmi, hf) -->\n<!-- h   <- clump_mr(h, p1=5e-8, r2=0.001, kb=10000, plink_ref=plink_ref) -->\n<!-- dat <- as.data.table(h)[index_snp==TRUE] -->\n<!-- saveRDS(dat, \"~/Desktop/tpmr_simulation.RDS\") -->\n<!-- ``` -->\n<!-- ```{r, include=FALSE} -->\n<!-- dat <- readRDS(\"~/Desktop/tpmr_simulation.RDS\") -->\n<!-- ``` -->\n\n<!-- ## Plot the variants -->\n<!-- ```{r, warning=FALSE, message=FALSE} -->\n<!-- p <- ggplot(dat, aes(x=bx, y=by, xmin=bx-bxse*1.96, xmax=bx+bxse*1.96, ymin=by-byse*1.96, ymax=by+byse*1.96)) + -->\n<!--   geom_errorbar(color=\"lightgrey\") + -->\n<!--   geom_errorbarh(color=\"lightgray\") + -->\n<!--   geom_point() + -->\n<!--   geom_smooth(method=\"lm\", se=F) -->\n<!-- p -->\n<!-- ``` -->\n\n<!-- ## Randomly select a proportion of the variants -->\n<!-- ```{r, warning=FALSE, message=FALSE} -->\n<!-- set.seed(123) -->\n<!-- proportion <- 0.2 -->\n<!-- dat[, selected := sample(c(TRUE, FALSE), .N, replace = TRUE, prob = c(proportion, 1 - proportion))] -->\n\n<!-- p <- ggplot(dat, aes(x=bx, y=by, xmin=bx-bxse*1.96, xmax=bx+bxse*1.96, ymin=by-byse*1.96, ymax=by+byse*1.96, color=selected)) + -->\n<!--   geom_errorbar(color=\"lightgrey\") + -->\n<!--   geom_errorbarh(color=\"lightgray\") + -->\n<!--   geom_point() + -->\n<!--   geom_smooth(method=\"lm\", se=F) -->\n<!-- p -->\n<!-- ``` -->\n\n<!-- ## Create different distributions of PPH4 weights -->\n<!-- ```{r, warning=FALSE, message=FALSE} -->\n<!-- min_pph4 <- 0.8 -->\n<!-- weighted <- lapply(1:20, function(dist_shape) { -->\n<!--   d <- copy(dat[selected==TRUE]) -->\n<!--   d[, `:=`(pph4  = min_pph4 + (1.0 - min_pph4) * rbeta(.N, shape1 = 5, shape2 = dist_shape), -->\n<!--            shape = dist_shape)] -->\n<!-- }) |> rbindlist() -->\n<!-- weighted[, mean_pph4 := round(mean(pph4),3), by=.(shape)] -->\n<!-- weighted[, mean_pph4 := factor(mean_pph4, levels = unique(mean_pph4))] -->\n\n<!-- p <- ggplot(weighted, aes(x=pph4, fill=mean_pph4)) + -->\n<!--   geom_density(alpha=0.2) -->\n<!-- p -->\n<!-- ``` -->\n\n<!-- ## Apply the weightings -->\n<!-- ```{r, warning=FALSE, message=FALSE} -->\n<!-- weighted[, bx_weighted := bx*pph4] -->\n\n<!-- p <- ggplot(weighted, aes(x=bx_weighted, y=by, xmin=bx-bxse*1.96, xmax=bx+bxse*1.96, ymin=by-byse*1.96, ymax=by+byse*1.96, color=mean_pph4)) + -->\n<!--   geom_point() + -->\n<!--   geom_smooth(method=\"lm\", se=F) -->\n<!-- p -->\n<!-- ``` -->\n\n<!-- ## IVW regression by different PPH4 weighting distributions -->\n<!-- ```{r, warning=FALSE, message=FALSE} -->\n<!-- ivw_result <- weighted[, { -->\n<!--   weights <- 1 / (byse^2) -->\n<!--   model   <- lm(by ~ bx_weighted - 0, weights = weights) -->\n<!--   coef_summary <- summary(model)$coefficients -->\n<!--   slope        <- coef_summary[\"bx_weighted\", \"Estimate\"] -->\n<!--   se_slope     <- coef_summary[\"bx_weighted\", \"Std. Error\"] -->\n<!--   list(slope = slope, se = se_slope) -->\n<!-- }, by = mean_pph4] -->\n\n<!-- ivw_result[, mean_pph4 := as.numeric(as.character(mean_pph4))] -->\n\n<!-- p <- ggplot(ivw_result, aes(x=mean_pph4, y=slope, ymin=slope-1.96*se, ymax=slope+1.96*se, color=mean_pph4, group=1)) + -->\n<!--   geom_errorbar() + -->\n<!--   geom_point() + -->\n<!--   labs(y=\"IVW MR estimate\") + -->\n<!--   guides(color = \"none\") -->\n<!-- p -->\n<!-- ``` -->\n\n<!-- ## Interpretation -->\n<!-- Lower colocalisation evidence (lower PPH4) for any given instrument set leads to increasing MR estimate for the effect of BMI on an outcome due to greater down weighting of the BMI betas and consequent increase in the regression slope. -->",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}