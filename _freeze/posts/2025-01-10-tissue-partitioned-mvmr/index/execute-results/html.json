{
  "hash": "647f4cafbd2c106482ccc65ffccb8cb5",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Tissue-partitioned BMI instrument procedure\"\nauthor: \"Nick Sunderland\"\ndate: \"2025-01-10\"\nexecute:\n  fig-path: \"posts/2025-01-10-tissue-partitioned-mvmr/\" \n---\n\n\n\n## Motivation\nWhat does the weighting by PPH4 do to tissue partitioned BMI instruments? Let's simulate some tissue partitioned BMI MR results.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(data.table)\nlibrary(ggplot2)\nlibrary(genepi.utils)\n```\n:::\n\n\n\n\n## BMI data\nFirst load the BMI GWAS.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot <- ggplot(mtcars, aes(wt, mpg)) + \n  geom_point() +\n  ggtitle(\"Heavy Plot Example\")\n\n# Save the plot locally\nggsave(\"heavy_plot.png\", plot, width = 6, height = 4)\n\n# bmi <- readRDS(file.path(dir, \"tmp_objects\", \"obj_bmi.RDS\"))\n# bmi\n```\n:::\n\n\n\n<!-- ## Heart failure data -->\n<!-- Load the heart failure GWAS. -->\n\n<!-- ```{r, message=FALSE, eval=F} -->\n<!-- hf <- readRDS(file.path(dir, \"tmp_objects\", \"obj_hf_allcause.RDS\")) -->\n<!-- hf -->\n<!-- ``` -->\n\n<!-- ## Harmonise the datasets -->\n<!-- ```{r, message=FALSE, eval=F} -->\n<!-- h   <- MR(bmi, hf) -->\n<!-- h   <- clump_mr(h, p1=5e-8, r2=0.001, kb=10000, plink_ref=plink_ref) -->\n<!-- dat <- as.data.table(h)[index_snp==TRUE] -->\n<!-- saveRDS(dat, \"~/Desktop/tpmr_simulation.RDS\") -->\n<!-- ``` -->\n<!-- ```{r, include=FALSE} -->\n<!-- dat <- readRDS(\"~/Desktop/tpmr_simulation.RDS\") -->\n<!-- ``` -->\n\n<!-- ## Plot the variants -->\n<!-- ```{r, warning=FALSE, message=FALSE} -->\n<!-- p <- ggplot(dat, aes(x=bx, y=by, xmin=bx-bxse*1.96, xmax=bx+bxse*1.96, ymin=by-byse*1.96, ymax=by+byse*1.96)) + -->\n<!--   geom_errorbar(color=\"lightgrey\") + -->\n<!--   geom_errorbarh(color=\"lightgray\") + -->\n<!--   geom_point() + -->\n<!--   geom_smooth(method=\"lm\", se=F) -->\n<!-- p -->\n<!-- ``` -->\n\n<!-- ## Randomly select a proportion of the variants -->\n<!-- ```{r, warning=FALSE, message=FALSE} -->\n<!-- set.seed(123) -->\n<!-- proportion <- 0.2 -->\n<!-- dat[, selected := sample(c(TRUE, FALSE), .N, replace = TRUE, prob = c(proportion, 1 - proportion))] -->\n\n<!-- p <- ggplot(dat, aes(x=bx, y=by, xmin=bx-bxse*1.96, xmax=bx+bxse*1.96, ymin=by-byse*1.96, ymax=by+byse*1.96, color=selected)) + -->\n<!--   geom_errorbar(color=\"lightgrey\") + -->\n<!--   geom_errorbarh(color=\"lightgray\") + -->\n<!--   geom_point() + -->\n<!--   geom_smooth(method=\"lm\", se=F) -->\n<!-- p -->\n<!-- ``` -->\n\n<!-- ## Create different distributions of PPH4 weights -->\n<!-- ```{r, warning=FALSE, message=FALSE} -->\n<!-- min_pph4 <- 0.8 -->\n<!-- weighted <- lapply(1:20, function(dist_shape) { -->\n<!--   d <- copy(dat[selected==TRUE]) -->\n<!--   d[, `:=`(pph4  = min_pph4 + (1.0 - min_pph4) * rbeta(.N, shape1 = 5, shape2 = dist_shape), -->\n<!--            shape = dist_shape)] -->\n<!-- }) |> rbindlist() -->\n<!-- weighted[, mean_pph4 := round(mean(pph4),3), by=.(shape)] -->\n<!-- weighted[, mean_pph4 := factor(mean_pph4, levels = unique(mean_pph4))] -->\n\n<!-- p <- ggplot(weighted, aes(x=pph4, fill=mean_pph4)) + -->\n<!--   geom_density(alpha=0.2) -->\n<!-- p -->\n<!-- ``` -->\n\n<!-- ## Apply the weightings -->\n<!-- ```{r, warning=FALSE, message=FALSE} -->\n<!-- weighted[, bx_weighted := bx*pph4] -->\n\n<!-- p <- ggplot(weighted, aes(x=bx_weighted, y=by, xmin=bx-bxse*1.96, xmax=bx+bxse*1.96, ymin=by-byse*1.96, ymax=by+byse*1.96, color=mean_pph4)) + -->\n<!--   geom_point() + -->\n<!--   geom_smooth(method=\"lm\", se=F) -->\n<!-- p -->\n<!-- ``` -->\n\n<!-- ## IVW regression by different PPH4 weighting distributions -->\n<!-- ```{r, warning=FALSE, message=FALSE} -->\n<!-- ivw_result <- weighted[, { -->\n<!--   weights <- 1 / (byse^2) -->\n<!--   model   <- lm(by ~ bx_weighted - 0, weights = weights) -->\n<!--   coef_summary <- summary(model)$coefficients -->\n<!--   slope        <- coef_summary[\"bx_weighted\", \"Estimate\"] -->\n<!--   se_slope     <- coef_summary[\"bx_weighted\", \"Std. Error\"] -->\n<!--   list(slope = slope, se = se_slope) -->\n<!-- }, by = mean_pph4] -->\n\n<!-- ivw_result[, mean_pph4 := as.numeric(as.character(mean_pph4))] -->\n\n<!-- p <- ggplot(ivw_result, aes(x=mean_pph4, y=slope, ymin=slope-1.96*se, ymax=slope+1.96*se, color=mean_pph4, group=1)) + -->\n<!--   geom_errorbar() + -->\n<!--   geom_point() + -->\n<!--   labs(y=\"IVW MR estimate\") + -->\n<!--   guides(color = \"none\") -->\n<!-- p -->\n<!-- ``` -->\n\n<!-- ## Interpretation -->\n<!-- Lower colocalisation evidence (lower PPH4) for any given instrument set leads to increasing MR estimate for the effect of BMI on an outcome due to greater down weighting of the BMI betas and consequent increase in the regression slope. -->",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}