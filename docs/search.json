[
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "Miscellaneous code and dynamic documents."
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "",
    "text": "What does the weighting by PPH4 do to tissue partitioned BMI instruments? Let’s simulate some tissue partitioned BMI MR results.\n\nlibrary(data.table)\nlibrary(ggplot2)\nlibrary(ggpubr)\nlibrary(genepi.utils)\nlibrary(tibble)\nlibrary(knitr)"
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#motivation",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#motivation",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "",
    "text": "What does the weighting by PPH4 do to tissue partitioned BMI instruments? Let’s simulate some tissue partitioned BMI MR results.\n\nlibrary(data.table)\nlibrary(ggplot2)\nlibrary(ggpubr)\nlibrary(genepi.utils)\nlibrary(tibble)\nlibrary(knitr)"
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#bmi-data",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#bmi-data",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "BMI data",
    "text": "BMI data\nFirst load the BMI GWAS.\n\nbmi    &lt;- readRDS(file.path(TPMR_DIR, \"output\", \"tmp_objects\", \"obj_bmi.RDS\"))\nclumps &lt;- clump(as.data.table(bmi), p1=5e-8, r2=0.001, kb=10000, plink2=PLINK2, plink_ref=UKBB_REFERENCE)[index==TRUE]\nbmi    &lt;- subset_gwas(bmi, clumps$rsid)\nkable(head(clumps, 5), caption = \"BMI lead variants\")\n\n\nBMI lead variants\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nrsid\nchr\nbp\nea\noa\neaf\nbeta\nse\np\nn\nncase\ntrait\nid\nstrand\nimputed\ninfo\nq\nq_p\ni2\nproxy_rsid\nproxy_chr\nproxy_bp\nproxy_ea\nproxy_oa\nproxy_eaf\nproxy_r2\nsnp\nindex\nclump\n\n\n\n\nrs10007906\n4\n31023610\nA\nC\n0.360300\n0.0133000\n0.0018000\n0\n686479\nNA\nbmi\ncombined_bmi_giant_ukb_annot.txt\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nrs10007906\nTRUE\n291\n\n\nrs1000940\n17\n5283252\nA\nG\n0.701300\n-0.0154000\n0.0018000\n0\n794558\nNA\nbmi\ncombined_bmi_giant_ukb_annot.txt\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nrs1000940\nTRUE\n142\n\n\nrs1007934\n14\n73463479\nA\nG\n0.415000\n-0.0120000\n0.0017000\n0\n692411\nNA\nbmi\ncombined_bmi_giant_ukb_annot.txt\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nrs1007934\nTRUE\n407\n\n\nrs10125137\n9\n118644190\nT\nC\n0.641786\n-0.0117273\n0.0020523\n0\n463005\nNA\nbmi\ncombined_bmi_giant_ukb_annot.txt\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nrs10125137\nTRUE\n811\n\n\nrs10131890\n14\n97258752\nA\nC\n0.950300\n-0.0222000\n0.0039000\n0\n691777\nNA\nbmi\ncombined_bmi_giant_ukb_annot.txt\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nrs10131890\nTRUE\n846"
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#heart-failure-data",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#heart-failure-data",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "Heart failure data",
    "text": "Heart failure data\nLoad the heart failure GWAS.\n\nhf &lt;- readRDS(file.path(TPMR_DIR, \"output\", \"tmp_objects\", \"obj_hf_allcause.RDS\"))\nhf &lt;- subset_gwas(hf, clumps$rsid)"
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#harmonise-the-datasets",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#harmonise-the-datasets",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "Harmonise the datasets",
    "text": "Harmonise the datasets\n\nh &lt;- MR(bmi, hf)\nkable(head(as.data.table(h),5), caption = \"Harmonised BMI:HF dataset\")\n\n\nHarmonised BMI:HF dataset\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nrsid\nchr\nbp\nea\noa\nbx\nbxse\npx\nby\nbyse\npy\nproxy_e_snp\nproxy_o_snp\nindex_snp\ngroup\nld_info\nexposure\noutcome\n\n\n\n\nrs10007906_C_A\n4\n31023610\nA\nC\n0.0133000\n0.0018000\n0\n0.0039\n0.0051\n0.44980\nNA\nNA\nTRUE\nNA\nFALSE\nbmi\nhf_allcause\n\n\nrs1000940_G_A\n17\n5283252\nA\nG\n-0.0154000\n0.0018000\n0\n0.0011\n0.0050\n0.82970\nNA\nNA\nTRUE\nNA\nFALSE\nbmi\nhf_allcause\n\n\nrs1007934_G_A\n14\n73463479\nA\nG\n-0.0120000\n0.0017000\n0\n-0.0092\n0.0049\n0.05931\nNA\nNA\nTRUE\nNA\nFALSE\nbmi\nhf_allcause\n\n\nrs10125137_C_T\n9\n118644190\nT\nC\n-0.0117273\n0.0020523\n0\n0.0033\n0.0049\n0.50820\nNA\nNA\nTRUE\nNA\nFALSE\nbmi\nhf_allcause\n\n\nrs10131890_C_A\n14\n97258752\nA\nC\n-0.0222000\n0.0039000\n0\n-0.0211\n0.0099\n0.03310\nNA\nNA\nTRUE\nNA\nFALSE\nbmi\nhf_allcause"
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#run-the-mr",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#run-the-mr",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "Run the MR",
    "text": "Run the MR\n\nres &lt;- run_mr(h)\nkable(res, caption = \"BMI:HF Mendelian randomisation\")\n\n\nBMI:HF Mendelian randomisation\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nmethod\ncorrelation\nexposure\noutcome\nn_snp\nb\nb_se\np\nintercept\nint_se\nint_p\nqstat\nqstat_p\nfstat\ncondfstat\noverdispersion\nn_pc\nn_hunted\nslopehunter_pi\nslopehunter_ent\n\n\n\n\nmr_ivw\nFALSE\nbmi\nhf_allcause\n874\n0.4872820\n0.0165599\n0\n0.0000000\nNA\nNA\n1592.460\n0\n60.70091\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nmr_egger\nFALSE\nbmi\nhf_allcause\n874\n0.5367727\n0.0464790\n0\n-0.0008232\n0.0007224\n0.2544728\n1590.092\n0\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nmr_weighted_median\nFALSE\nbmi\nhf_allcause\n874\n0.5078217\n0.0236696\n0\n0.0000000\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nmr_weighted_mode\nFALSE\nbmi\nhf_allcause\n874\n0.5456300\n0.0523114\n0\n0.0000000\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA"
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#plot-mr",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#plot-mr",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "Plot MR",
    "text": "Plot MR\n\nplot_mr(h, res)"
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#select-variants---mr-with-a-subset-of-bmi-variants",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#select-variants---mr-with-a-subset-of-bmi-variants",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "Select variants - MR with a subset of BMI variants",
    "text": "Select variants - MR with a subset of BMI variants\nIn the Leyden et al. 2022 paper 86 variant colocalise with adipose tissue eQTLs and 140 colocalise with brain tissue eQTLs. There is overlap between the two tissues of 43 variants.\n\nset.seed(123)\ntissue1_varid &lt;- sample(h@snps, 140)\noverlap_varid &lt;- sample(tissue1_varid, 43)\ntissue2_varid &lt;- c(overlap_varid, sample(h@snps[!h@snps %in% overlap_varid], 86-43))\n\n# turn of variants not in either tissue\nh@index_snp[!h@snps %in% c(tissue1_varid, tissue2_varid)] &lt;- FALSE\nh@exposure &lt;- \"BMI tissue 1/2 SNPs\"\n\nres1 &lt;- run_mr(h)\nkable(res1, caption = \"BMI:HF Mendelian randomisation (Tissue 1 & 2 SNPs only)\")\n\n\nBMI:HF Mendelian randomisation (Tissue 1 & 2 SNPs only)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nmethod\ncorrelation\nexposure\noutcome\nn_snp\nb\nb_se\np\nintercept\nint_se\nint_p\nqstat\nqstat_p\nfstat\ncondfstat\noverdispersion\nn_pc\nn_hunted\nslopehunter_pi\nslopehunter_ent\n\n\n\n\nmr_ivw\nFALSE\nBMI tissue 1/2 SNPs\nhf_allcause\n177\n0.5108471\n0.0363407\n0e+00\n0.0000000\nNA\nNA\n304.2402\n0\n61.28134\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nmr_egger\nFALSE\nBMI tissue 1/2 SNPs\nhf_allcause\n177\n0.5475313\n0.1037260\n1e-07\n-0.0006034\n0.0015974\n0.7056336\n303.9924\n0\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nmr_weighted_median\nFALSE\nBMI tissue 1/2 SNPs\nhf_allcause\n177\n0.5730810\n0.0494983\n0e+00\n0.0000000\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nmr_weighted_mode\nFALSE\nBMI tissue 1/2 SNPs\nhf_allcause\n177\n0.5887868\n0.1022882\n0e+00\n0.0000000\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\n\n\nplot_mr(h, res1)"
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#run-multivariable-mr-unweighted",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#run-multivariable-mr-unweighted",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "Run multivariable MR (unweighted)",
    "text": "Run multivariable MR (unweighted)\n\n# copy of BMI for tissue 1\nbmi_t1 &lt;- bmi\nbmi_t1@id &lt;- \"bmi tissue 1\"\nbmi_t1@trait &lt;- \"bmi tissue 1\"\n\n# copy of BMI for tissue 2\nbmi_t2 &lt;- bmi\nbmi_t2@id &lt;- \"bmi tissue 2\"\nbmi_t2@trait &lt;- \"bmi tissue 2\"\n\n# harmonise\nh_mvmr &lt;- MR(list(bmi_t1, bmi_t2), hf)\n\n# turn of variants not in either tissue\nh_mvmr@index_snp[!h_mvmr@snps %in% c(tissue1_varid, tissue2_varid)] &lt;- FALSE\n\nres2 &lt;- run_mr(h_mvmr, methods=\"mr_ivw\")\nkable(res2, caption = \"BMI:HF MV Mendelian randomisation\")\n\n\nBMI:HF MV Mendelian randomisation\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nmethod\ncorrelation\nexposure\noutcome\nn_snp\nb\nb_se\np\nintercept\nint_se\nint_p\nqstat\nqstat_p\nfstat\ncondfstat\noverdispersion\nn_pc\nn_hunted\nslopehunter_pi\nslopehunter_ent\n\n\n\n\nmr_mvivw\nFALSE\nbmi tissue 1\nhf_allcause\n177\n0.5108471\n0.0363407\n0\n0\nNA\nNA\n302.5116\n0\nNA\n0\nNA\nNA\nNA\nNA\nNA\n\n\nmr_mvivw\nFALSE\nbmi tissue 2\nhf_allcause\n177\n0.5108471\n0.0363407\n0\n0\nNA\nNA\n302.5116\n0\nNA\n0\nNA\nNA\nNA\nNA\nNA\n\n\n\n\nplot_mr(h_mvmr, res2)"
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#bmieqtl-pph4-distributions-by-tissue",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#bmieqtl-pph4-distributions-by-tissue",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "BMI:eQTL PPH4 distributions by tissue",
    "text": "BMI:eQTL PPH4 distributions by tissue\n\nNumber of colocalising variants per tissue\n\ncoloc_thresh &lt;- 0.8\n\ncoloc_results &lt;- fread(file.path(TPMR_DIR, \"output\", \"tables\", \"coloc_results.tsv.gz\"))\ncoloc_counts &lt;- coloc_results[locus_trait==\"bmi\" & grepl(\"^bmi\", trait.x) & !grepl(\"^bmi|^hf_\", trait.y), .SD[which.max(pph4)], by=.(locus_index_rsid,trait.y)][, .(`num_coloc_pph4` = sum(pph4&gt;coloc_thresh)), by=c(tissue=\"trait.y\")][, tissue := factor(tissue, levels = tissue[order(-`num_coloc_pph4`)])]\n\nggplot(coloc_counts, aes(y = tissue, x = `num_coloc_pph4`)) +\n  theme_classic() +\n  geom_col(fill= \"blue\", alpha = 0.3) +\n  labs(subtitle = paste(\"coloc thresh:\", coloc_thresh), \n       x = \"Number of colocalising BMI variants\") +\n  theme(axis.title.y = element_blank())\n\n\n\n\n\n\n\n\n\n\nMax. PPH4 distributions by tissue\nTake the maximum PPH4 from genes in close proximity to each variant, in each tissue.\n\nnum_tissues &lt;- 20\ntissues_subset &lt;- levels(coloc_counts$tissue)[as.integer(seq(1, length(levels(coloc_counts$tissue)), length.out=num_tissues))] \ncoloc_subset &lt;- coloc_results[locus_trait==\"bmi\" & trait.x==\"bmi\" & (trait.y %in% tissues_subset), .SD[which.max(pph4)], by=.(locus_index_rsid,trait.y)]\n\ndensity &lt;- coloc_subset[, {\n  den &lt;- density(pph4, n=1000)\n  .(pph4 = scales::rescale(den$x, 0:1), prob = den$y)\n}, by = c(tissue=\"trait.y\")][, tissue := factor(tissue, levels = levels(coloc_counts$tissue))]\n\nggplot(density, aes(x=pph4, y=prob, color=tissue)) +\n  theme_classic() +\n  geom_line() +\n  labs(y = \"Density\")"
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#can-we-achieve-these-densities-randomly",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#can-we-achieve-these-densities-randomly",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "Can we achieve these densities randomly",
    "text": "Can we achieve these densities randomly\nYes, just sample the PPH4 from the actual density distributions above.\n\ntissues &lt;- expand.grid(tissue = unique(density$tissue), stringsAsFactors = F) |&gt; as.data.table()\n\nset.seed(123)\n\nres_sim_density &lt;- tissues[, {\n  .(sim_pph4 = sample(density[tissue==.BY$tissue, pph4], length(h_mvmr@bx[,1]), prob = density[tissue==.BY$tissue, prob], replace = TRUE))\n}, by = .(tissue)]\n\n\nggplot(res_sim_density, aes(x=sim_pph4, color=tissue)) +\n  theme_classic() +\n  geom_density() +\n  labs(y = \"Simulated density\", \n       x = \"Simulated PPH4\")"
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#effect-different-pph4-weights",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#effect-different-pph4-weights",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "Effect different PPH4 weights",
    "text": "Effect different PPH4 weights\nWeight the BMI betas by their respective maximum PPH4 value, see how this changes the relationship between the beta for BMI and beta for HF, dependent on which tissue is providing the betas. Tissues with greater or fewer colocalising variants affect push the betas up or down more, respectively. I hold one tissue constant (reference) to more easily appreciate how the other tissue’s colocalisation characteristics affect things.\n\nref_tissue &lt;- levels(density$tissue)[1]\ntissue_pairs &lt;- expand.grid(t1 = ref_tissue, t2 = unique(density$tissue), stringsAsFactors = F) |&gt; as.data.table()\ntissue_pairs[density[, .(mean_pph4 = mean(pph4*prob)), by=tissue], t1_mean_pph4 := i.mean_pph4, on=c(\"t1\"=\"tissue\")]\ntissue_pairs[density[, .(mean_pph4 = mean(pph4*prob)), by=tissue], t2_mean_pph4 := i.mean_pph4, on=c(\"t2\"=\"tissue\")]\n\nset.seed(123)\nt1_pph4 &lt;- sample(density[tissue==ref_tissue, pph4], length(h_mvmr@bx[,1]), prob = density[tissue==ref_tissue, prob], replace = TRUE)\n\nres_weighted &lt;- tissue_pairs[, {\n  h_tmp &lt;- h_mvmr\n  t2_pph4 &lt;- sample(density[tissue==.BY$t2, pph4], length(h_tmp@bx[,1]), prob = density[tissue==.BY$t2, prob], replace = TRUE)\n  h_tmp@bx[,1] &lt;- h_tmp@bx[,1] * t1_pph4\n  h_tmp@bx[,2] &lt;- h_tmp@bx[,2] * t2_pph4\n  h_tmp@index_snp &lt;- ifelse(t1_pph4&gt;coloc_thresh | t2_pph4&gt;coloc_thresh, TRUE, FALSE)\n  .(tissue   = rep(c(paste0(\"Ref: \", ref_tissue),\"Comparator\"), each=sum(h_tmp@index_snp)), \n    beta_bmi = c(h_tmp@bx[h_tmp@index_snp,1], h_tmp@bx[h_tmp@index_snp,2]), \n    beta_hf  = rep(h_tmp@by[h_tmp@index_snp],2),\n    mean_pph4_t1 = mean(t1_pph4[t1_pph4&gt;coloc_thresh | t2_pph4&gt;coloc_thresh]),\n    mean_pph4_t2 = mean(t2_pph4[t1_pph4&gt;coloc_thresh | t2_pph4&gt;coloc_thresh]))\n}, by = .(t1,t2)]\n\n\nggplot(res_weighted, aes(x=beta_bmi, y=beta_hf, color=tissue)) +\n  geom_point() +\n  geom_text(data = unique(res_weighted[grepl(\"Ref\", tissue)], by=\"t2\"), \n            aes(x = 0.0, \n                y = -0.04,\n                label = sprintf(\"Tis mPPH4=%.3f\", mean_pph4_t2)),\n            color=\"black\", size=2) +\n  geom_text(data = unique(res_weighted[!grepl(\"Ref\", tissue)], by=\"t2\"), \n            aes(x = 0.0, \n                y = -0.07,\n                label = sprintf(\"Ref mPPH4=%.3f\", mean_pph4_t1)),\n            color=\"black\", size=2) +\n  geom_smooth(method=\"lm\", se=F,fullrange = TRUE) +\n  facet_wrap(~t2, labeller = labeller(t2 = function(x) gsub(\"_\", \" \", x))) +\n  labs(y = \"Heart failure beta\", \n       x = \"BMI beta (PPH4-weighted)\", \n       color = \"Tissue\")"
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#ivw-regression-by-different-pph4-weighting-distributions",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#ivw-regression-by-different-pph4-weighting-distributions",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "IVW regression by different PPH4 weighting distributions",
    "text": "IVW regression by different PPH4 weighting distributions\nPerform MVMR with the weighted BMI instruments. Lets look at holding a poorly colocalising tissue constant compared to the best colocalising tissues.\n\nReference: top colocalising tissue\nDifferent distributions against the top colocalising tissue.\n\nref_tissue &lt;- levels(density$tissue)[1] # top colocalising tissue\ntissue_pairs &lt;- expand.grid(t1 = ref_tissue, t2 = unique(density$tissue), stringsAsFactors = F) |&gt; as.data.table()\ntissue_pairs[density[, .(mean_pph4 = mean(pph4*prob)), by=tissue], t1_mean_pph4 := i.mean_pph4, on=c(\"t1\"=\"tissue\")]\ntissue_pairs[density[, .(mean_pph4 = mean(pph4*prob)), by=tissue], t2_mean_pph4 := i.mean_pph4, on=c(\"t2\"=\"tissue\")]\n\nset.seed(123)\nt1_pph4 &lt;- sample(density[tissue==ref_tissue, pph4], length(h_mvmr@bx[,1]), prob = density[tissue==ref_tissue, prob], replace = TRUE)\n\nmr_weighted &lt;- tissue_pairs[, {\n  h_tmp &lt;- h_mvmr\n  t2_pph4 &lt;- sample(density[tissue==.BY$t2, pph4], length(h_tmp@bx[,1]), prob = density[tissue==.BY$t2, prob], replace = TRUE)\n  h_tmp@bx[,1] &lt;- h_tmp@bx[,1] * t1_pph4\n  h_tmp@bx[,2] &lt;- h_tmp@bx[,2] * t2_pph4\n  h_tmp@index_snp &lt;- ifelse(t1_pph4&gt;coloc_thresh | t2_pph4&gt;coloc_thresh, TRUE, FALSE)\n  h_tmp@exposure[1] &lt;- paste0(\"Ref: \", ref_tissue)\n  h_tmp@exposure[2] &lt;- \"Comparator\"\n  r &lt;- run_mr(h_tmp, methods=\"mr_ivw\")\n  r[, `:=`(n_sig_snps = c(sum(t1_pph4&gt;coloc_thresh), sum(t2_pph4&gt;coloc_thresh)), \n           n_overlap_snps = sum(t1_pph4&gt;coloc_thresh & t2_pph4&gt;coloc_thresh))]\n}, by = .(t1,t2,t1_mean_pph4,t2_mean_pph4)]\n\nggplot(mr_weighted, aes(x=t2, y=exp(b), ymin=exp(b-b_se*1.96), ymax=exp(b+b_se*1.96), color=exposure)) +\n  geom_errorbar(width=0.2, position = position_dodge(0.2)) +\n  geom_point(aes(size=n_sig_snps), position = position_dodge(0.2)) +\n  theme(axis.text.x = element_text(angle=45, hjust=1), \n        axis.title.y = element_blank()) +\n  labs(y = \"MR estimate (tpBMI vs HF)\", color = \"Tissue\", size = \"Num. SNPs contributed to model\")\n\n\n\n\n\n\n\n\n\n\nReference: worst colocalising tissue\nThen, different distributions against the worst colocalising tissue.\n\nref_tissue &lt;- levels(density$tissue)[length(levels(density$tissue))] # bottom/worst colocalising tissue\n\ntissue_pairs &lt;- expand.grid(t1 = ref_tissue, t2 = unique(density$tissue), stringsAsFactors = F) |&gt; as.data.table()\ntissue_pairs[density[, .(mean_pph4 = mean(pph4*prob)), by=tissue], t1_mean_pph4 := i.mean_pph4, on=c(\"t1\"=\"tissue\")]\ntissue_pairs[density[, .(mean_pph4 = mean(pph4*prob)), by=tissue], t2_mean_pph4 := i.mean_pph4, on=c(\"t2\"=\"tissue\")]\n\nset.seed(123)\nt1_pph4 &lt;- sample(density[tissue==ref_tissue, pph4], length(h_mvmr@bx[,1]), prob = density[tissue==ref_tissue, prob], replace = TRUE)\n\nmr_weighted &lt;- tissue_pairs[, {\n  h_tmp &lt;- h_mvmr\n  t2_pph4 &lt;- sample(density[tissue==.BY$t2, pph4], length(h_tmp@bx[,1]), prob = density[tissue==.BY$t2, prob], replace = TRUE)\n  h_tmp@bx[,1] &lt;- h_tmp@bx[,1] * t1_pph4\n  h_tmp@bx[,2] &lt;- h_tmp@bx[,2] * t2_pph4\n  h_tmp@index_snp &lt;- ifelse(t1_pph4&gt;coloc_thresh | t2_pph4&gt;coloc_thresh, TRUE, FALSE)\n  h_tmp@exposure[1] &lt;- paste0(\"Ref: \", ref_tissue)\n  h_tmp@exposure[2] &lt;- \"Comparator\"\n  r &lt;- run_mr(h_tmp, methods=\"mr_ivw\")\n  r[, `:=`(n_sig_snps = c(sum(t1_pph4&gt;coloc_thresh), sum(t2_pph4&gt;coloc_thresh)), \n           n_overlap_snps = sum(t1_pph4&gt;coloc_thresh & t2_pph4&gt;coloc_thresh))]\n}, by = .(t1,t2,t1_mean_pph4,t2_mean_pph4)]\n\nggplot(mr_weighted, aes(x=t2, y=exp(b), ymin=exp(b-b_se*1.96), ymax=exp(b+b_se*1.96), color=exposure)) +\n  geom_errorbar(width=0.2, position = position_dodge(0.2)) +\n  geom_point(aes(size=n_sig_snps), position = position_dodge(0.2)) +\n  theme(axis.text.x = element_text(angle=45, hjust=1), \n        axis.title.y = element_blank()) +\n  labs(y = \"MR estimate (tpBMI vs HF)\", color = \"Tissue\", size = \"Num. SNPs contributed to model\")"
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#number-of-colocalising-loci",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#number-of-colocalising-loci",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "Number of colocalising loci",
    "text": "Number of colocalising loci\nIs it just mostly to do with the difference in the number of colocalising variants in each tissue. Run MR for all pairs of tissues.\n\ntissue_pairs &lt;- expand.grid(t1 = unique(density$tissue), t2 = unique(density$tissue), stringsAsFactors = F) |&gt; as.data.table()\ntissue_pairs[density[, .(mean_pph4 = mean(pph4*prob)), by=tissue], t1_mean_pph4 := i.mean_pph4, on=c(\"t1\"=\"tissue\")]\ntissue_pairs[density[, .(mean_pph4 = mean(pph4*prob)), by=tissue], t2_mean_pph4 := i.mean_pph4, on=c(\"t2\"=\"tissue\")]\n\nset.seed(123)\nmr_weighted &lt;- tissue_pairs[, {\n  h_tmp &lt;- h_mvmr\n  t1_pph4 &lt;- sample(density[tissue==.BY$t1, pph4], length(h_tmp@bx[,1]), prob = density[tissue==.BY$t1, prob], replace = TRUE)\n  t2_pph4 &lt;- sample(density[tissue==.BY$t2, pph4], length(h_tmp@bx[,1]), prob = density[tissue==.BY$t2, prob], replace = TRUE)\n  h_tmp@bx[,1] &lt;- h_tmp@bx[,1] * t1_pph4\n  h_tmp@bx[,2] &lt;- h_tmp@bx[,2] * t2_pph4\n  h_tmp@index_snp &lt;- ifelse(t1_pph4&gt;coloc_thresh | t2_pph4&gt;coloc_thresh, TRUE, FALSE)\n  h_tmp@exposure[1] &lt;- \"t1\"\n  h_tmp@exposure[2] &lt;- \"t2\"\n  r &lt;- run_mr(h_tmp, methods=\"mr_ivw\")\n  r[, `:=`(n_sig_snps = c(sum(t1_pph4&gt;coloc_thresh), sum(t2_pph4&gt;coloc_thresh)),\n           n_uni_snps = c(length(setdiff(which(t1_pph4&gt;coloc_thresh), which(t2_pph4&gt;coloc_thresh))), length(setdiff(which(t2_pph4&gt;coloc_thresh), which(t1_pph4&gt;coloc_thresh)))),\n           n_overlap_snps = sum(t1_pph4&gt;coloc_thresh & t2_pph4&gt;coloc_thresh), \n           n_sig_diff = sum(t1_pph4&gt;coloc_thresh) - sum(t2_pph4&gt;coloc_thresh), \n           exp_b_diff = diff(range(exp(b))))]\n}, by = .(t1,t2,t1_mean_pph4,t2_mean_pph4)]\n\nggplot(mr_weighted, aes(x=n_sig_snps, y=exp(b), ymin=exp(b-b_se*1.96), ymax=exp(b+b_se*1.96), color=exposure)) +\n  geom_errorbar(width=0.2, position = position_dodge(0.2)) +\n  geom_point(position = position_dodge(0.2)) +\n  theme(axis.text.x = element_text(angle=45, hjust=1), \n        axis.title.y = element_blank()) +\n  labs(y = \"MR estimate (tpBMI vs HF)\", color = \"Tissue\", size = \"Num. SNPs contributed to model\") +\n  facet_wrap(~exposure)"
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#interpretation",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#interpretation",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "Interpretation",
    "text": "Interpretation\n…."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Nick Sunderland's lab book",
    "section": "",
    "text": "Date\n\n\nTitle\n\n\nCategories\n\n\n\n\n\n\nJan 10, 2025\n\n\nTissue-partitioned BMI instrument procedure\n\n\n \n\n\n\n\n\nNo matching items"
  }
]