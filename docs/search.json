[
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "Miscellaneous code and dynamic documents."
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "",
    "text": "What does the weighting by PPH4 do to tissue partitioned BMI instruments? Let’s simulate some tissue partitioned BMI MR results.\n\nlibrary(data.table)\nlibrary(ggplot2)\nlibrary(ggpubr)\nlibrary(genepi.utils)\nlibrary(tibble)\nlibrary(knitr)"
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#motivation",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#motivation",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "",
    "text": "What does the weighting by PPH4 do to tissue partitioned BMI instruments? Let’s simulate some tissue partitioned BMI MR results.\n\nlibrary(data.table)\nlibrary(ggplot2)\nlibrary(ggpubr)\nlibrary(genepi.utils)\nlibrary(tibble)\nlibrary(knitr)"
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#bmi-data",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#bmi-data",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "BMI data",
    "text": "BMI data\nFirst load the BMI GWAS.\n\nbmi    &lt;- readRDS(file.path(TPMR_DIR, \"output\", \"tmp_objects\", \"obj_bmi.RDS\"))\nclumps &lt;- clump(as.data.table(bmi), p1=5e-8, r2=0.001, kb=10000, plink2=PLINK2, plink_ref=UKBB_REFERENCE)[index==TRUE]\nbmi    &lt;- subset_gwas(bmi, clumps$rsid)\nkable(head(clumps, 5), caption = \"BMI lead variants\")\n\n\nBMI lead variants\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nrsid\nchr\nbp\nea\noa\neaf\nbeta\nse\np\nn\nncase\ntrait\nid\nstrand\nimputed\ninfo\nq\nq_p\ni2\nproxy_rsid\nproxy_chr\nproxy_bp\nproxy_ea\nproxy_oa\nproxy_eaf\nproxy_r2\nsnp\nindex\nclump\n\n\n\n\nrs10007906\n4\n31023610\nA\nC\n0.360300\n0.0133000\n0.0018000\n0\n686479\nNA\nbmi\ncombined_bmi_giant_ukb_annot.txt\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nrs10007906\nTRUE\n291\n\n\nrs1000940\n17\n5283252\nA\nG\n0.701300\n-0.0154000\n0.0018000\n0\n794558\nNA\nbmi\ncombined_bmi_giant_ukb_annot.txt\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nrs1000940\nTRUE\n142\n\n\nrs1007934\n14\n73463479\nA\nG\n0.415000\n-0.0120000\n0.0017000\n0\n692411\nNA\nbmi\ncombined_bmi_giant_ukb_annot.txt\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nrs1007934\nTRUE\n407\n\n\nrs10125137\n9\n118644190\nT\nC\n0.641786\n-0.0117273\n0.0020523\n0\n463005\nNA\nbmi\ncombined_bmi_giant_ukb_annot.txt\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nrs10125137\nTRUE\n811\n\n\nrs10131890\n14\n97258752\nA\nC\n0.950300\n-0.0222000\n0.0039000\n0\n691777\nNA\nbmi\ncombined_bmi_giant_ukb_annot.txt\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nrs10131890\nTRUE\n846"
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#heart-failure-data",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#heart-failure-data",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "Heart failure data",
    "text": "Heart failure data\nLoad the heart failure GWAS.\n\nhf &lt;- readRDS(file.path(TPMR_DIR, \"output\", \"tmp_objects\", \"obj_hf_allcause.RDS\"))\nhf &lt;- subset_gwas(hf, clumps$rsid)"
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#harmonise-the-datasets",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#harmonise-the-datasets",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "Harmonise the datasets",
    "text": "Harmonise the datasets\n\nh &lt;- MR(bmi, hf)\nkable(head(as.data.table(h),5), caption = \"Harmonised BMI:HF dataset\")\n\n\nHarmonised BMI:HF dataset\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nrsid\nchr\nbp\nea\noa\nbx\nbxse\npx\nby\nbyse\npy\nproxy_e_snp\nproxy_o_snp\nindex_snp\ngroup\nld_info\nexposure\noutcome\n\n\n\n\nrs10007906_C_A\n4\n31023610\nA\nC\n0.0133000\n0.0018000\n0\n0.0039\n0.0051\n0.44980\nNA\nNA\nTRUE\nNA\nFALSE\nbmi\nhf_allcause\n\n\nrs1000940_G_A\n17\n5283252\nA\nG\n-0.0154000\n0.0018000\n0\n0.0011\n0.0050\n0.82970\nNA\nNA\nTRUE\nNA\nFALSE\nbmi\nhf_allcause\n\n\nrs1007934_G_A\n14\n73463479\nA\nG\n-0.0120000\n0.0017000\n0\n-0.0092\n0.0049\n0.05931\nNA\nNA\nTRUE\nNA\nFALSE\nbmi\nhf_allcause\n\n\nrs10125137_C_T\n9\n118644190\nT\nC\n-0.0117273\n0.0020523\n0\n0.0033\n0.0049\n0.50820\nNA\nNA\nTRUE\nNA\nFALSE\nbmi\nhf_allcause\n\n\nrs10131890_C_A\n14\n97258752\nA\nC\n-0.0222000\n0.0039000\n0\n-0.0211\n0.0099\n0.03310\nNA\nNA\nTRUE\nNA\nFALSE\nbmi\nhf_allcause"
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#run-the-mr",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#run-the-mr",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "Run the MR",
    "text": "Run the MR\n\nres &lt;- run_mr(h)\nkable(res, caption = \"BMI:HF Mendelian randomisation\")\n\n\nBMI:HF Mendelian randomisation\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nmethod\ncorrelation\nexposure\noutcome\nn_snp\nb\nb_se\np\nintercept\nint_se\nint_p\nqstat\nqstat_p\nfstat\ncondfstat\noverdispersion\nn_pc\nn_hunted\nslopehunter_pi\nslopehunter_ent\n\n\n\n\nmr_ivw\nFALSE\nbmi\nhf_allcause\n874\n0.4872820\n0.0165599\n0\n0.0000000\nNA\nNA\n1592.460\n0\n60.70091\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nmr_egger\nFALSE\nbmi\nhf_allcause\n874\n0.5367727\n0.0464790\n0\n-0.0008232\n0.0007224\n0.2544728\n1590.092\n0\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nmr_weighted_median\nFALSE\nbmi\nhf_allcause\n874\n0.5078217\n0.0236696\n0\n0.0000000\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nmr_weighted_mode\nFALSE\nbmi\nhf_allcause\n874\n0.5456300\n0.0523114\n0\n0.0000000\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA"
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#plot-mr",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#plot-mr",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "Plot MR",
    "text": "Plot MR\n\nplot_mr(h, res)"
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#select-variants",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#select-variants",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "Select variants",
    "text": "Select variants\nIn the Leyden et al. 2022 paper 86 variant colocalise with adipose tissue eQTLs and 140 colocalise with brain tissue eQTLs. There is overlap between the two tissues of 43 variants.\n\nset.seed(123)\ntissue1_varid &lt;- sample(h@snps, 140)\noverlap_varid &lt;- sample(tissue1_varid, 43)\ntissue2_varid &lt;- c(overlap_varid, sample(h@snps[!h@snps %in% overlap_varid], 86-43))\n\n# turn of variants not in either tissue\nh@index_snp[!h@snps %in% c(tissue1_varid, tissue2_varid)] &lt;- FALSE\nh@exposure &lt;- \"BMI tissue 1/2 SNPs\"\n\nres1 &lt;- run_mr(h)\nkable(res1, caption = \"BMI:HF Mendelian randomisation (Tissue 1 & 2 SNPs only)\")\n\n\nBMI:HF Mendelian randomisation (Tissue 1 & 2 SNPs only)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nmethod\ncorrelation\nexposure\noutcome\nn_snp\nb\nb_se\np\nintercept\nint_se\nint_p\nqstat\nqstat_p\nfstat\ncondfstat\noverdispersion\nn_pc\nn_hunted\nslopehunter_pi\nslopehunter_ent\n\n\n\n\nmr_ivw\nFALSE\nBMI tissue 1/2 SNPs\nhf_allcause\n177\n0.5108471\n0.0363407\n0e+00\n0.0000000\nNA\nNA\n304.2402\n0\n61.28134\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nmr_egger\nFALSE\nBMI tissue 1/2 SNPs\nhf_allcause\n177\n0.5475313\n0.1037260\n1e-07\n-0.0006034\n0.0015974\n0.7056336\n303.9924\n0\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nmr_weighted_median\nFALSE\nBMI tissue 1/2 SNPs\nhf_allcause\n177\n0.5730810\n0.0494983\n0e+00\n0.0000000\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nmr_weighted_mode\nFALSE\nBMI tissue 1/2 SNPs\nhf_allcause\n177\n0.5887868\n0.1022882\n0e+00\n0.0000000\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\n\n\nplot_mr(h, res1)"
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#run-multivariable-mr-unweighted",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#run-multivariable-mr-unweighted",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "Run multivariable MR (unweighted)",
    "text": "Run multivariable MR (unweighted)\n\n# copy of BMI for tissue 1\nbmi_t1 &lt;- bmi\nbmi_t1@id &lt;- \"bmi tissue 1\"\nbmi_t1@trait &lt;- \"bmi tissue 1\"\n\n# copy of BMI for tissue 2\nbmi_t2 &lt;- bmi\nbmi_t2@id &lt;- \"bmi tissue 2\"\nbmi_t2@trait &lt;- \"bmi tissue 2\"\n\n# harmonise\nh_mvmr &lt;- MR(list(bmi_t1, bmi_t2), hf)\n\n# turn of variants not in either tissue\nh_mvmr@index_snp[!h_mvmr@snps %in% c(tissue1_varid, tissue2_varid)] &lt;- FALSE\n\nres2 &lt;- run_mr(h_mvmr, methods=\"mr_ivw\")\nkable(res2, caption = \"BMI:HF MV Mendelian randomisation\")\n\n\nBMI:HF MV Mendelian randomisation\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nmethod\ncorrelation\nexposure\noutcome\nn_snp\nb\nb_se\np\nintercept\nint_se\nint_p\nqstat\nqstat_p\nfstat\ncondfstat\noverdispersion\nn_pc\nn_hunted\nslopehunter_pi\nslopehunter_ent\n\n\n\n\nmr_mvivw\nFALSE\nbmi tissue 1\nhf_allcause\n177\n0.5108471\n0.0363407\n0\n0\nNA\nNA\n302.5116\n0\nNA\n0\nNA\nNA\nNA\nNA\nNA\n\n\nmr_mvivw\nFALSE\nbmi tissue 2\nhf_allcause\n177\n0.5108471\n0.0363407\n0\n0\nNA\nNA\n302.5116\n0\nNA\n0\nNA\nNA\nNA\nNA\nNA\n\n\n\n\nplot_mr(h_mvmr, res2)"
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#create-different-distributions-of-pph4-weights",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#create-different-distributions-of-pph4-weights",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "Create different distributions of PPH4 weights",
    "text": "Create different distributions of PPH4 weights\nFor tissue 2 create different distributions of weights\n\nmin_pph4 &lt;- 0.8\nweights &lt;- lapply(1:20, function(dist_shape) {\n  d &lt;- data.table(varid = h_mvmr@snps[h_mvmr@index_snp])\n  norm &lt;- rnorm(1000, mean = 0, sd = 1)\n  hi_dist &lt;- 0.9 + (1.0 - 0.9) * (norm - min(norm)) / (max(norm) - min(norm))\n  lo_dist &lt;- 0.0 + (0.3 - 0.0) * (norm - min(norm)) / (max(norm) - min(norm))\n  sq_dist &lt;- min_pph4 + (1.0 - min_pph4) * rbeta(1000, shape1 = 1, shape2 = dist_shape)\n  d[, tissue := fcase(varid %in% overlap_varid, \"both\", \n                      varid %in% tissue1_varid, \"tissue1\", \n                      varid %in% tissue2_varid, \"tissue2\")]\n  d[tissue==\"both\",    c(\"pph4_t1\", \"pph4_t2\") := .(sample(hi_dist, .N, replace = T), sample(sq_dist, .N, replace = T))]\n  d[tissue==\"tissue1\", c(\"pph4_t1\", \"pph4_t2\") := .(sample(hi_dist, .N, replace = T), sample(lo_dist, .N, replace = T))]\n  d[tissue==\"tissue2\", c(\"pph4_t1\", \"pph4_t2\") := .(sample(lo_dist, .N, replace = T), sample(sq_dist, .N, replace = T))]\n  d[, t2_shape := dist_shape]\n  d\n}) |&gt; rbindlist()\nweights[, mean_pph4_t2 := round(mean(pph4_t2[tissue %in% c(\"both\",\"tissue2\")]),3), by=.(t2_shape)]\nweights[, mean_pph4_t2 := factor(mean_pph4_t2, levels = sort(unique(mean_pph4_t2)))]\n\nggplot(weights, aes(x=pph4_t2, fill=mean_pph4_t2)) +\n  geom_density(alpha=0.2) +\n  theme_classic() +\n  guides(fill = \"none\")"
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#effect-different-pph4-weights",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#effect-different-pph4-weights",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "Effect different PPH4 weights",
    "text": "Effect different PPH4 weights\nFix the PPH4 weighting on tissue 1 to PPH4=1.0, i.e. unadjusted BMI beta. Then apply the different weights to tissue 2.\n\nres_weighted &lt;- weights[, {\n  h_tmp &lt;- h_mvmr\n  order_idx &lt;- match(varid, h_tmp@snps)\n  h_tmp@bx[order_idx,1] &lt;- h_tmp@bx[order_idx,1] * pph4_t1\n  h_tmp@bx[order_idx,2] &lt;- h_tmp@bx[order_idx,2] * pph4_t2\n  .(tissue = rep(h_tmp@exposure_id, each=length(order_idx)), beta_bmi = c(h_tmp@bx[order_idx,1], h_tmp@bx[order_idx,2]), beta_hf = rep(h_tmp@by[order_idx],2))\n}, by = mean_pph4_t2]\n\n\nggplot(res_weighted, aes(x=beta_bmi, y=beta_hf, color=tissue)) +\n  geom_point() +\n  geom_smooth(method=\"lm\", se=F) +\n  facet_wrap(~mean_pph4_t2, labeller = labeller(mean_pph4_t2 = function(x) paste(\"Mean PPH4 =\", x)))"
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#ivw-regression-by-different-pph4-weighting-distributions",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#ivw-regression-by-different-pph4-weighting-distributions",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "IVW regression by different PPH4 weighting distributions",
    "text": "IVW regression by different PPH4 weighting distributions\n\nmr_weighted &lt;- weights[, {\n  h_tmp &lt;- h_mvmr\n  order_idx &lt;- match(varid, h_tmp@snps)\n  h_tmp@bx[order_idx,1] &lt;- h_tmp@bx[order_idx,1] * pph4_t1\n  h_tmp@bx[order_idx,2] &lt;- h_tmp@bx[order_idx,2] * pph4_t2\n  r &lt;- run_mr(h_tmp, methods=\"mr_ivw\")\n  r[, used_mean_pph4 := mean(pph4_t2[pph4_t2&gt;min_pph4])]\n  r\n}, by = mean_pph4_t2]\n\nggplot(mr_weighted, aes(x=used_mean_pph4, y=exp(b), ymin=exp(b-b_se*1.96), ymax=exp(b+b_se*1.96), color=exposure)) +\n  geom_point() +\n  geom_errorbar()"
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#number-of-colocalising-loci",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#number-of-colocalising-loci",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "Number of colocalising loci",
    "text": "Number of colocalising loci\nThe actual PPH4 value does not seem to have a great influence, it may be just more to do with the number of colocalising variants in each tissue."
  },
  {
    "objectID": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#interpretation",
    "href": "posts/2025-01-10-tissue-partitioned-mvmr/index.html#interpretation",
    "title": "Tissue-partitioned BMI instrument procedure",
    "section": "Interpretation",
    "text": "Interpretation\nLower colocalisation evidence (lower PPH4) for any given instrument set leads to increasing MR estimate for the effect of BMI on an outcome due to greater down weighting of the BMI betas and consequent increase in the regression slope."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Nick Sunderland's lab book",
    "section": "",
    "text": "Date\n\n\nTitle\n\n\nCategories\n\n\n\n\n\n\nJan 10, 2025\n\n\nTissue-partitioned BMI instrument procedure\n\n\n \n\n\n\n\n\nNo matching items"
  }
]